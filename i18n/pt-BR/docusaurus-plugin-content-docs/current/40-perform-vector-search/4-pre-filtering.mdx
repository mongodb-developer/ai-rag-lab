# ü¶π Combinar pr√©-filtragem com busca vetorial

Pr√©-filtragem √© uma t√©cnica para otimizar a busca vetorial considerando apenas documentos que correspondem a certos crit√©rios durante a busca vetorial.

Nesta se√ß√£o, voc√™ aprender√° como combinar filtros com busca vetorial. Isso envolve principalmente:
* Atualizar o √≠ndice de busca vetorial para incluir os campos de filtro apropriados
* Atualizar o est√°gio `$vectorSearch` na defini√ß√£o do pipeline de agrega√ß√£o para incluir os filtros

Preencha quaisquer espa√ßos reservados `<CODE_BLOCK_N>` e execute as c√©lulas sob a se√ß√£o **ü¶π‚Äç‚ôÄÔ∏è Combine pre-filtering with vector search** no notebook para experimentar combinando pr√©-filtros com suas consultas de busca vetorial.

As respostas para os blocos de c√≥digo nesta se√ß√£o s√£o as seguintes:

**CODE_BLOCK_10**

<details>
<summary>Resposta</summary>
<div>
```json
{
    "name": ATLAS_VECTOR_SEARCH_INDEX_NAME,
    "type": "vectorSearch",
    "definition": {
        "fields": [
            {
                "type": "vector",
                "path": "embedding",
                "numDimensions": 384,
                "similarity": "cosine"
            },
            {"type": "filter", "path": "metadata.productName"}
        ]
    }
}
```
</div>
</details>

**CODE_BLOCK_11**

<details>
<summary>Resposta</summary>
<div>
```json
[
    {
        "$vectorSearch": {
            "index": ATLAS_VECTOR_SEARCH_INDEX_NAME,
            "path": "embedding",
            "queryVector": query_embedding,
            "numCandidates": 150,
            "limit": 5,
            "filter": {"metadata.productName": "MongoDB Atlas"}
        }
    },
    {
        "$project": {
            "_id": 0,
            "body": 1,
            "score": {"$meta": "vectorSearchScore"}
        }
    }
]
```
</div>
</details>

**CODE_BLOCK_12**

<details>
<summary>Resposta</summary>
<div>
```json
{
    "name": ATLAS_VECTOR_SEARCH_INDEX_NAME,
    "type": "vectorSearch",
    "definition": {
        "fields": [
            {
                "type": "vector",
                "path": "embedding",
                "numDimensions": 384,
                "similarity": "cosine"
            },
            {"type": "filter", "path": "metadata.contentType"},
            {"type": "filter", "path": "updated"}
        ]
    }
}
```
</div>
</details>

**CODE_BLOCK_13**

<details>
<summary>Resposta</summary>
<div>
```json
[
    {
        "$vectorSearch": {
            "index": ATLAS_VECTOR_SEARCH_INDEX_NAME,
            "path": "embedding",
            "queryVector": query_embedding,
            "numCandidates": 150,
            "limit": 5,
            "filter": {
                "$and": [
                    {"metadata.contentType": "Tutorial"},
                    {"updated": {"$gte": "2024-05-19"}}
                ]
            }
        }
    },
    {
        "$project": {
            "_id": 0,
            "body": 1,
            "updated": 1,
            "score": {"$meta": "vectorSearchScore"}
        }
    }
]
```
</div>
</details>